<div class="relative">
  <div id="slider" class="overflow-x-auto snap-x snap-mandatory flex space-x-6 px-4">
    {{ $projSec := site.GetPage "section" "projects" }}
    {{ range $projSec.Pages }}
      <div class="snap-center shrink-0 w-[90vw] md:w-[70vw] lg:w-[60vw] max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 pb-6">
       {{ with .Resources.GetMatch "featured*" }}
        <img src="{{ .RelPermalink }}" alt="{{ .Title }}"
              class="w-full max-h-[50vh] md:max-h-[60vh] object-contain rounded-lg mb-6 mx-auto">
      {{ end }}

        <!-- 제목 -->
        <h3 class="text-2xl font-bold mb-2 text-center">{{ .Title }}</h3>
        
      </div>
    {{ end }}
  </div>

  <!-- 좌우 버튼 -->
  <button id="prevBtn" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/70 dark:bg-gray-700 p-2 rounded-full shadow">
    ◀
  </button>
  <button id="nextBtn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/70 dark:bg-gray-700 p-2 rounded-full shadow">
    ▶
  </button>
</div>

<script>
  const slides = document.querySelectorAll('.snap-center');
  const track = document.getElementById('slider');
  let index = 0;
  let autoSlide = null;

  // 자동 넘김 시작/멈춤
  function startAuto() {
    if (autoSlide) return; // 이미 동작중이면 중복 실행 방지
    autoSlide = setInterval(() => {
      index++;
      show();
    }, 5000);
  }
  function stopAuto() {
    if (!autoSlide) return;
    clearInterval(autoSlide);
    autoSlide = null;
  }

  function show(){
    if(index < 0)
      index = slides.length - 1;
    if(index >= slides.length)
      index = 0;

    const target = slides[index];
    const offset = target.offsetLeft - (track.clientWidth - target.clientWidth) / 2;

    track.scrollTo({
      left: offset,
      behavior: "smooth"
    });
  }

  document.getElementById('prevBtn').addEventListener('click', () => {
    index--;
    show();
  });

  document.getElementById('nextBtn').addEventListener('click', () => {
    index++;
    show();
  });

    // 마우스 올리면 멈춤 / 나가면 다시 실행
  track.addEventListener('mouseenter', stopAuto);
  track.addEventListener('mouseleave', startAuto);

  // 탭이 백그라운드로 가면 멈춤 / 다시 오면 실행
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) stopAuto();
    else startAuto();
  });

  // 화면에 보일 때만 자동 넘김 켜기
  const observer = new IntersectionObserver(
    (entries) => {
      if (entries[0].isIntersecting) startAuto();
      else stopAuto();
    },
    { threshold: 0.3 } // 30% 이상 보일 때 동작
  );
  observer.observe(track);
</script>